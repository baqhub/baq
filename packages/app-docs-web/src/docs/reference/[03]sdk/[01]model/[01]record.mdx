export const metadata = {
  id: "4b9504a7",
  title: "Record",
  summary: "Base class for all record types.",
};

# Record

Base class for all record types.

```ts
const newRecord = PostRecord.new(...);
const updatedRecord = TaskRecord.update(...);
const subscription = FileRecord.subscribe(...);
```

{props.toc}

## Reference

### `Record`

#### Static methods

<props.properties>

- **<props.code>delete(entity, record, action?)</props.code>**: <props.pill href="#nocontentrecord">NoContentRecord</props.pill>

  - Create a [`NoContentRecord`](#nocontentrecord) tombstone from an existing record.

  - _Parameters_

    <props.properties>

    - `entity` <props.pill href="deae588f#entity">Entity</props.pill>

      - Entity of the user performing the deletion.

    - `record` <props.pill>Record</props.pill>

      - Record to delete.

    - `action` <props.pill href="#nocontentrecordaction">NoContentRecordAction</props.pill> _optional_

      - Type of deletion to perform.

      - Defaults to `delete`.

    </props.properties>

- **<props.code>isPublic(record: <props.pill>Record</props.pill>)</props.code>**: <props.pill>boolean</props.pill>

  - Check whether a record has public permissions.

- **<props.code>hasType\<T\>(record: <props.pill>Record</props.pill>, type: <props.pill>RecordType\<T\></props.pill>)</props.code>**: <props.pill>boolean</props.pill>

  - Check whether a record is of a given type.

  - Acts as a type guard for `record` as `T`.

- **<props.code>toKey(record: <props.pill>Record</props.pill>)</props.code>**: <props.pill href="#recordkey">RecordKey</props.pill>

  - Get the key for a record.

- **<props.code>toLink(record: <props.pill>Record</props.pill>)</props.code>**: <props.pill href="c20d7b98">RecordLink</props.pill>

  - Get a link to a record.

- **<props.code>toVersionHash(record: <props.pill>Record</props.pill>)</props.code>**: <props.pill href="deae588f#versionhash">VersionHash | undefined</props.pill>

  - Get the version hash for a record, if any.

</props.properties>

#### Subclass static fields

Available on any specific record type derived from the base `Record` class like those [generated by the CLI](/todo).

<props.properties>

- **<props.code>new(entity, content, options?)</props.code>**: <props.pill>Record</props.pill>

  - Create a new record of that record type.

  - _Parameters_

    <props.properties>

    - `entity` <props.pill href="deae588f#entity">Entity</props.pill>

      - Entity of the user creating the record.

    - `content` <props.pill>object</props.pill>

      - Type-specific content of the new record.

    </props.properties>

  - _Options_

    <props.properties>

    - `id` <props.pill>string</props.pill> _optional_

      - Explicitly provide the ID for the new record.

    - `mode` <props.pill href="#recordmode">RecordMode</props.pill> _optional_

      - Should the record be synchronized or kept local.

      - Defaults to `synced`.

    - `permissions` <props.pill href="3d6c2ea8">RecordPermissions</props.pill> _optional_

      - Permissions for the record.

      - Defaults to [private permissions](/todo).

    </props.properties>

- **<props.code>update(entity, record, content, options?)</props.code>**: <props.pill>Record</props.pill>

  - Update an existing record of that record type.

  - _Parameters_

    <props.properties>

    - `entity` <props.pill href="deae588f#entity">Entity</props.pill>

      - Entity of the user updating the record.

    - `record` <props.pill>Record</props.pill>

      - Record to update.

    - `content` <props.pill>object</props.pill>

      - Type-specific content of the updated record.

    </props.properties>

  - Accepts the same options as `new()`.

- **<props.code>subscribe(entity, publisherEntity, options?)</props.code>**: <props.pill>Record</props.pill>

  - Subscribe to records of that record type from a given publisher.

  - _Parameters_

    <props.properties>

    - `entity` <props.pill href="deae588f#entity">Entity</props.pill>

      - Entity of the subscribing user.

    - `publisherEntity` <props.pill href="deae588f#entity">Entity</props.pill>

      - Entity to subscribe to.

    </props.properties>

  - _Options_

    <props.properties>

    - `id` <props.pill>string</props.pill> _optional_

      - Explicitly provide the ID for the new subscription record.

    - `readPermissions` <props.pill href="3d6c2ea8">"public" | EntityLink[]</props.pill> _optional_

      - Read permissions for the subscription record.

      - Defaults to [private permissions](/todo).

    </props.properties>

- **`link`**: <props.pill href="c20d7b98">RecordLink</props.pill>

  - Record link to this record type.

</props.properties>

#### Properties

<props.properties>

- **`author`** <props.pill href="880d482d">EntityLink</props.pill>

  - Entity link to the initial author of the record.

- **`id`** <props.pill href="deae588f#recordid">RecordId</props.pill>

  - Unique identifier of the record within the scope of its initial author.

- **`source`** <props.pill href="#recordsource">RecordMode</props.pill>

  - How the server obtained this record.

- **`createdAt`** <props.pill>Date</props.pill>

  - Date at which the record initially created according to the author.

- **`receivedAt`** <props.pill>Date</props.pill> _optional_

  - Date at which the record was received by the server.

  - Not available when not synchronized with the server.

- **`version`** <props.pill href="#recordversion">RecordVersion</props.pill>

  - Versioning-specific details.

- **`permissions`** <props.pill href="3d6c2ea8">RecordPermissions</props.pill>

  - Access control information.

- **`type`** <props.pill href="8a6f1bed">VersionLink</props.pill>

  - Version link to the type record defining the record's schema.

- **`content`** <props.pill>object</props.pill>

  - Content of the record, type-specific.

- **`mode`** <props.pill href="#recordmode">RecordMode</props.pill>

  - Whether this is a local-only record.

</props.properties>

### `RecordKey`

Unique string identifier that combines a record's author entity and ID. It makes it possible to pass around a string to identify a record without losing typing information.

```ts
const key: RecordKey<T>;
```

{/* prettier-ignore */}
```ts
"entity.host.com+ce85c896c24a4685b5a5d480cc4814ef"
```

### `RecordSource`

Enum that indicates where the record came from.

Possible values:

<props.compactList>

- `self` : Created by the server's user.

- `resolution` : Record downloaded from a link.

- `notification` : Received through a [notification](/todo).

- `subscription` : Received through a [subscription](/todo).

- `proxy` : [Proxied](/todo) record.

</props.compactList>

### `RecordMode`

Enum for the SDK to know whether a record should pushed to the server.

Possible values:

<props.compactList>

- `synced` : The record should be synchronized with the server.

- `local` : The record is local-only.

</props.compactList>

### `RecordVersion`

#### Properties

<props.properties>

- **`author`** <props.pill href="880d482d">EntityLink</props.pill>

  - Entity link to the author of the record version.

- **`hash`** <props.pill href="deae588f#versionhash">VersionHash</props.pill> _optional_

  - SHA256 hash of the [canonical JSON representation](/docs/learn/recordversion) of the record.

  - Not available when not synchronized with the server.

- **`createdAt`** <props.pill>Date</props.pill>

  - Date at which the record version was created according to the author.

- **`receivedAt`** <props.pill>Date</props.pill> _optional_

  - Date at which the record version was received by the server.

  - Not available when not synchronized with the server.

- **`parentHash`** <props.pill href="deae588f#versionhash">VersionHash</props.pill> _optional_

  - Version hash of this version's parent, if any.

</props.properties>

### `NoContentRecord`

"Tombstone" that replaces a record after it gets deleted.

#### Properties

Same as [`Record`](#record), except that `content` is replaced with the following:

<props.properties>

- **`noContent`** <props.pill>object</props.pill>

  - _Properties_

    <props.properties>

    - `action` <props.pill href="#nocontentrecordaction">NoContentRecordAction</props.pill>

      - Type of deletion.

      - Defaults to `delete`.

    </props.properties>

</props.properties>

### `NoContentRecordAction`

Type of deletion for a `NoContentRecord`.

#### Values

<props.compactList>

- `delete`: Standard deletion, propagate to others.
- `local`: Only delete from the user's server, not propagated.
- `leave`: Remove our user without deleting for others.

</props.compactList>

## Usage

### Create a new record

The methods provided on a Record Type class help creating records by providing full type-checking of the record's content. Here we create a new private [Task record](/todo).

```ts
import {TaskRecord} from "./baq/taskRecord.js";

function createTask(entity, title) {
  return TaskRecord.new(entity, {
    title,
    completed: false,
  });
}
```

### Create a new public record

Records are private by default. Making one public requires explicit permissions. Here we create a public [Post record](/todo) with a short text as content.

```ts
import {RecordPermissions} from "@baqhub/sdk";
import {PostRecord} from "./baq/postRecord.js";

function createPost(entity, text) {
  return PostRecord.new(
    entity,
    {text},
    {permissions: RecordPermissions.public}
  );
}
```

### Update an existing record

Updating a record requires providing the existing record. This will set the `parent_hash` value and opt into [optimistic concurrency control](ee55634d#request) when the record is synchronized with the server.

Here we update a Task record by changing the `completed` value in its content.

```ts
import {TaskRecord} from "./baq/taskRecord.js";

function markTaskAsCompleted(entity, task) {
  return TaskRecord.update(task, entity, {
    ...task.content,
    completed: true,
  });
}
```

### Delete an existing record

Deleting a record requires providing the existing record. This will set the `parent_hash` value and opt into [optimistic concurrency control](ee55634d#request) when the record is synchronized with the server.

Here we delete create a `NoContentRecord` from a Task record.

```ts
import {Record} from "@baqhub/sdk";

function deleteTask(entity, task) {
  return Record.delete(entity, task);
}
```

### Create a subscription record

Subscribing to another user's public records is done by creating a [Subscription record](5609fae1) for a given type. Here we create a private subscription to Post records.

```ts
import {PostRecord} from "./baq/postRecord.js";

function subscribeToPosts(entity, publisherEntity) {
  return PostRecord.subscribe(entity, publisherEntity);
}
```
